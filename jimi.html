<!DOCTYPE html>

<html>
<head>
<title>Max Mu Portal Entry</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
html { height: 100%; }
body { height: 100%; margin: 0; padding: 0; }
.container {display: flex; height: 100%; flex-direction: column;}
#map_canvas {width:100%; height:90%; min-height: 200px;}
#border {width: 100%; height: 1%; min-height: 5px; background-color: #0078B5; cursor: ns-resize;}
#results {width:100%; height:0%; overflow:auto; min-height: 0px;}
#slider {width: 50%; overflow:auto;}
ul.no_bullet {list-style-type: none; padding: 0; margin: 0; }
li.checked {background: url('./images/checked.png') no-repeat left top; padding-left: 36px; padding-top: 4px; line-height: 1.5em; height:auto}
li.unchecked {background: url('./images/unchecked.png') no-repeat left top; padding-left: 36px; padding-top: 4px; line-height: 1.5em; height:auto}
</style>

<script type="text/javascript">

var map;
var mapInitialized = false;
var s2data = {};
var s2polygons = [];

function FindWeights(fields, cells, areas) {
    // fields: [{name: string, mu: number}]
    // cells: [string]
    // areas: [[number]] indexed by [field][cell]
    let count = []; // count of cells each field intersects
    for (let i=0; i<areas.length; i++) {
        count[i] = 0;
        for (let j=0; j<areas[i].length; j++) {
            if (areas[i][j] > 0) {
                count[i]++;
            }
        }
    }
    for (let i=0; i<fields.length; i++) {
        console.log(fields[i].name + " " + count[i]);
    }
    let range = {}; // range of weights for each cell
    let solved = []; // fields that are computable from known weights

    for (let i=0; i<fields.length; i++) {
        if (count[i] == 1) {
            solved.push(i);
            let cellIndex = 0;
            for (let j=0; j<areas[i].length; j++) {
                if (areas[i][j] > 0) {
                    cellIndex = j;
                }
            }
            let cell = cells.ids[cellIndex];
            let minWeight = areas[i][cellIndex]/(fields[i].mu + 0.5);
            let maxWeight = areas[i][cellIndex]/(fields[i].mu - 0.5);
            console.log(cell + ": " + minWeight + " - " + maxWeight);
            if (range.hasOwnProperty(cell)) {
                // Further constrain the range with the data of this new field 
                if (minWeight > range[cell].min)
                    range[cell].min = minWeight;
                if (maxWeight < range[cell].max)
                    range[cell].max = maxWeight;
                if (minWeight > maxWeight)
                    debugger;
            }
            else {
                range[cell] = {min: minWeight, max: maxWeight};
            }
        }
    }
    // maybe that special case for 1 will go away if the next step generalizes for 1
    let foundOne = false;
    do {
        foundOne = false;
        for (let i=0; i<fields.length; i++) {
            if (solved.includes(i)) continue;
            let unsolvedCount = 0;
            let cellIndex;
            let minSum = 0;
            let maxSum = 0;
            for (let j=0; j<areas[i].length; j++) {
                if (areas[i][j] > 0) {
                    if (range.hasOwnProperty(cells.ids[j])) {
                        maxSum += areas[i][j]/range[cells.ids[j]].min;
                        minSum += areas[i][j]/range[cells.ids[j]].max;
                    }
                    else {
                        unsolvedCount++;
                        cellIndex = j;
                    }
                }
            }
            if (unsolvedCount > 1) continue;
            if (unsolvedCount == 0) {
                //debugger;
                //console.log("Field " + i + " is solved by previous fields");
                foundOne = true;
                solved.push(i);
                //console.log("Solved: ");
                //console.log(solved);
                // Use this field's MU to further constrain the ranges on another field

                // Which one has the biggest range
                let biggestRange = -1;
                for (let j=0; j<areas[i].length; j++) {
                    if (areas[i][j] > 0) {
                        let r = range[cells.ids[j]].max - range[cells.ids[j]].min;
                        if (r > biggestRange) {
                            cellIndex = j;
                            biggestRange = r;
                        }
                    }
                }
                maxSum -= areas[i][cellIndex]/range[cells.ids[cellIndex]].min;
                minSum -= areas[i][cellIndex]/range[cells.ids[cellIndex]].max;     
            }
            console.log("Field " + i + " can be solved");
            foundOne = true;
            solved.push(i);

            let cell = cells.ids[cellIndex];

            // Instead of this for min/max we need to solve by substitution
            //let minWeight = areas[i][cellIndex]/(fields[i].mu + 0.5);
            //let maxWeight = areas[i][cellIndex]/(fields[i].mu - 0.5);
            //
            // Like....
            // fields[i].mu +/- 0.5 = sum of (area[i][cellJ]/{min or max for cellJ)
            // so this cells area/{minmax} is the fieldMu - sum of other contributions
            // minmax = area/(fieldMu - sum of other contributions)
            //let maxWeight = areas[i][cellIndex]/(fields[i].mu - 0.5 - maxSum);
            //let minWeight = areas[i][cellIndex]/(fields[i].mu + 0.5 - minSum);
            // fields[i].mu - 0.5 - maxSum can be a negative number
            // fields[i].mu - maxSum should be positive if there's a solution at this s2 level
            // oh, maybe not
            // but fields[i].mu - minSum should be positive if there's a solution
            // if fields[i].mu - 0.5 - maxSum is negative, the other ranges can be narrowed
            // but the max weight for this cell given the other ranges is...
            // unbounded?
            // It seems like the max weight would be if this were the only cell
            // contributing.  If the field were entirely in this cell.
            let maxWeight;
            let minWeight;
            if (fields[i].mu + 0.5 <= minSum) {
                // no solution
                console.log("No solution!  Try smaller cells for " + cell);
                return;
            }
            else {
                minWeight = areas[i][cellIndex]/(fields[i].mu + 0.5 - minSum);
            
                if (fields[i].mu - 0.5 <= maxSum) {
                    // TODO try to constrain one of those other weights
                    // maybe put this one in a try-again-with-more-data pass
                    // for now try fudging it
                    if (fields[i].mu > maxSum) {
                        maxWeight = areas[i][cellIndex]/(fields[i].mu - maxSum);
                    }
                    else if (fields[i].mu + 0.5 > maxSum) {
                        maxWeight = areas[i][cellIndex]/(fields[i].mu + 0.5 - maxSum);
                    }
                    else {
                        maxWeight = minWeight + 1000; // ???
                    }

                    // On the other hand, what it really means is that the area over this cell is so small
                    // that the contribution is insignificant - and could be 0.
                    // A contribution of 0 is an unbounded max weight.
                    maxWeight = Number.MAX_VALUE;

                }
                else {
                    maxWeight = areas[i][cellIndex]/(fields[i].mu - 0.5 - maxSum);
                }
            }

            console.log(cell + ": " + minWeight + " - " + maxWeight + "(by substitution)");
            if (range.hasOwnProperty(cell)) {
                // Further constrain the range with the data of this new field 
                if (Math.max(minWeight, range[cell].min) > Math.min(maxWeight, range[cell].max)) {
                    console.log("Math.max(minWeight, range[cell].min) = Math.max(" 
                        + minWeight + ", " + range[cell].min + ")) = "
                        + Math.max(minWeight, range[cell].min));
                    console.log("Math.min(maxWeight, range[cell].max) = Math.min(" 
                        + maxWeight + ", " + range[cell].max + ")) = "
                        + Math.min(maxWeight, range[cell].max));
                    console.log("No solution!  Try smaller cells for " + cell);
                    return;
                }
                if (minWeight > range[cell].min)
                    range[cell].min = minWeight;
                if (maxWeight < range[cell].max)
                    range[cell].max = maxWeight;
                console.log(cell + " is now " + range[cell].min + " - " + range[cell].max);
            }
            else {
                range[cell] = {min: minWeight, max: maxWeight};
                if (minWeight > maxWeight)
                    debugger;
            }
        }
    } while (foundOne);
    
    console.log(range);
    let biggestRange = -1;
    for (let ri in range) {
        let r = range[ri].max - range[ri].min;
        if (r > biggestRange) {
            cell = ri;
            biggestRange = r;
        }
    }
    console.log("Biggest range");
    console.log(cell);
    console.log(range[cell]);

    let minMid = 99999;
    let maxMid = -1;
    for (let ri in range) {
        if (range[ri].max - range[ri].min > 100) continue;
        let mid = (range[ri].max + range[ri].min)/2;
        range[ri].mid = mid;
        if (mid < minMid) minMid = mid;
        if (mid > maxMid) maxMid = mid;
    }
    for (let cell = 0; cell < cells.bounds.length; cell++) {
        let id = cells.ids[cell];
        if (!range.hasOwnProperty(id)) continue;
        if (range[id].max - range[id].min > 100) continue;

        let opacity = 0.8 - (range[id].mid - minMid)/(2*(maxMid - minMid));
        new google.maps.Polygon({
            path: cells.bounds[cell],
            strokeColor: '#0000FF',
            strokeOpacity: opacity,
            strokeWeight: 1,
            fillOpacity: opacity,
            fillColor: '#0000FF',
            map: map
        });    
    }
}

function drawS2Grid() {
    for (let i=0; i<s2polygons.length; i++){
        s2polygons[i].setMap(null);
    }
    s2polygons = [];
    for (let i=0;i<s2data.length;i++){
        s2polygons.push(new google.maps.Polygon({
            path: s2data[i].points,
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWeight: 1,
            fillOpacity: 0,
            map: map
        }));
    }
    console.log("Cell count: " + s2data.length);
    if (s2data.length < 100) {
        for (let i=0;i<s2data.length;i++){
            let lat = 0;
            let lng = 0;
            for (let point in s2data[i].points) {
                lat += s2data[i].points[point].lat;
                lng += s2data[i].points[point].lng;                
            }
            lat /= s2data[i].points.length;
            lng /= s2data[i].points.length;
            s2polygons.push(new google.maps.Marker({
                position: new google.maps.LatLng(lat,lng),
                map: map,
                icon: "/images/transparent.png",
                label: {
                    text: s2data[i].name,
                    color: "blue",
                    fontWeight: "bold",
                    fontSize: "16px"
                }
            }));
        }
    }
}

function refreshS2Grid(level) {
    let bounds = map.getBounds();
    let ne = bounds.getNorthEast();
    let sw = bounds.getSouthWest();
    let rectPoints = ne.lat().toString() + "," + ne.lng().toString()
                + "_" + ne.lat().toString() + "," + sw.lng().toString()
                + "_" + sw.lat().toString() + "," + ne.lng().toString()
                + "_" + sw.lat().toString() + "," + sw.lng().toString();
    $.ajax({
        url:"cover?minLevel=" 
            + level 
            + "&maxLevel="
            + level
            + "&rectpoints="
            + rectPoints,
        success:function(data){
            $("#s2cellLevel").val(level);
            s2data = JSON.parse(data);
            drawS2Grid();
        },
        error:function(jqXHR, textStatus, errorThrown) {
            if (jqXHR.status == 403) {
                // Clear the drawn cells
                for (let i=0; i<s2polygons.length; i++){
                    s2polygons[i].setMap(null);
                }
                s2polygons = [];
                // Inform the user they're too zoomed out to draw the cells at the requested level
                $("#s2cellLevel").val(level + " (zoom in)");
            }
            else {
                console.log('getJSON request failed! ' + textStatus);
                console.log("incoming Text " + jqXHR.responseText);
            }
        }      
    });                         
}

function initializeMap()
{
    if (!mapInitialized)
    {
        // Default map options
        var mapOptions = { center: new google.maps.LatLng(47.488451,-122.169666),
                            zoom: 10,
                            mapTypeId: google.maps.MapTypeId.ROADMAP };
        
        map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
        mapInitialized=true;
        
        let portals = [
{
"title": "All to Myself I Think of You Memorial",
"guid": "72366c69a9004a1c8086ea65217c3b08.16",
"latlng": "47.486764,-122.170208"
},
{
"title": "Little Free Library At Heritage Park",
"guid": "d42bb777c7dc43c2b52ef3d9e3981be9.16",
"latlng": "47.485808,-122.166327"
},
{
"title": "Garden of Friends Bench",
"guid": "f1c552ce6d9448519f7184f77a16b470.16",
"latlng": "47.488083,-122.169903"
},
{
"title": "Basketball Half-Court At Heritage Park",
"guid": "debe044ba71f403292c9975d373e65ce.16",
"latlng": "47.486303,-122.164632"
},
{
"title": "Cedar View Memorial",
"guid": "cd2f34d0a9d14319a4009265c0270b6e.16",
"latlng": "47.488451,-122.169666"
},
{
"title": "Sempre nel nostro cuore..Con amure bench",
"guid": "c89f546ac11c4117ace1017557b6af69.16",
"latlng": "47.487944,-122.170096"
},
{
"title": "Renton Aerie No 1722 F.O.E.",
"guid": "c27f113e47a14941bee221b37a2341ca.16",
"latlng": "47.488222,-122.171616"
},
{
"title": "Greenwood Memorial Geometrical Fountain ",
"guid": "0e97ad3a95da44938898eef25f733a7d.16",
"latlng": "47.487722,-122.170559"
},
{
"title": "East Memorial Wall",
"guid": "73fcb6a9a4384778931aafb5ae1f9f4c.16",
"latlng": "47.488078,-122.169664"
}
            /*
            {
                "title": "Lullabyland Memorial",
                "guid": "8bd8aa38bdf24d5d9486420edea7f678.16",
                "latlng": "47.486297,-122.172124"
            },
            {
                "title": "All to Myself I Think of You Memorial",
                "guid": "72366c69a9004a1c8086ea65217c3b08.16",
                "latlng": "47.486764,-122.170208"
            },
            {
                "title": "Garden of Harmony",
                "guid": "fa67200b17c34a38a17b50a6f9c90453.16",
                "latlng": "47.486712,-122.173687"
            },
            {
                "title": "Metamorphosis",
                "guid": "1caf28a8dc7040f0bd5ae272b153255b.16",
                "latlng": "47.48793,-122.173166"
            },
            {
                "title": "Time Enough",
                "guid": "bf099bc0367a4b508691ae6aafdc5eb5.16",
                "latlng": "47.486537,-122.174261"
            },
            {
                "title": "Iu-Mienh Community Memorial ",
                "guid": "b130f28bc5634c45a0405680e35c25d7.16",
                "latlng": "47.48535,-122.174513"
            },
            {
                "title": "Sempre nel nostro cuore..Con amure bench",
                "guid": "c89f546ac11c4117ace1017557b6af69.16",
                "latlng": "47.487944,-122.170096"
            },
            {
                "title": "Renton Aerie No 1722 F.O.E.",
                "guid": "c27f113e47a14941bee221b37a2341ca.16",
                "latlng": "47.488222,-122.171616"
            },
            {
                "title": "Memories Fountain",
                "guid": "c23d58817f454ce2aef0dd95945b641d.16",
                "latlng": "47.485701,-122.172339"
            },
            {
                "title": "Yeah Yeah Thanks Puddin",
                "guid": "7cd14f47dc4a41d5bff70174c4b96b28.16",
                "latlng": "47.488086,-122.174574"
            },
            {
                "title": "Love Forever Headstone",
                "guid": "df1e0ae4843e4221ac301331aedfb129.16",
                "latlng": "47.48752,-122.172903"
            },
            {
                "title": "Hurricane Katrina Memorial",
                "guid": "c2b32b1c9a944701bc57c9ad155c52bf.16",
                "latlng": "47.485937,-122.17432"
            },
            {
                "title": "Greenwood Memorial Geometrical Fountain ",
                "guid": "0e97ad3a95da44938898eef25f733a7d.16",
                "latlng": "47.487722,-122.170559"
            },
            {
                "title": "Sun Dial",
                "guid": "721500f064644c69847c8f2f86cf0bcf.16",
                "latlng": "47.486194,-122.171397"
            },
            {
                "title": "East Memorial Wall",
                "guid": "73fcb6a9a4384778931aafb5ae1f9f4c.16",
                "latlng": "47.488078,-122.169664"
            },
            {
                "title": "Garden of Friends Bench",
                "guid": "f1c552ce6d9448519f7184f77a16b470.16",
                "latlng": "47.488083,-122.169903"
            },
            {
                "title": "Jimi Hendrix Memorial",
                "guid": "8bc08af55f64419bb099d826550d1beb.12",
                "latlng": "47.486514,-122.173947"
            },
            {
                "title": "Pastor Lee Arthur Dennis Memorial Bench",
                "guid": "49ca64d3a78c46eb93199d07dc7f443b.16",
                "latlng": "47.486706,-122.172068"
            },
            {
                "title": "Together Forever Bench",
                "guid": "a84d9b260e4f4509ab8c1efa16c57500.16",
                "latlng": "47.48524,-122.171777"
            },
            {
                "title": "Garden of Eternal Peace Pagoda",
                "guid": "2327a393e34a4b1aa0914f1182b27f24.16",
                "latlng": "47.48619,-122.174287"
            },
            {
                "title": "Remembered Forever",
                "guid": "17cbb13c1e0f4db6be88538fdcd58d36.16",
                "latlng": "47.487686,-122.173709"
            },
            {
                "title": "Fountain of Youth",
                "guid": "572e008622d745f38999d5402801fc6c.16",
                "latlng": "47.486378,-122.174457"
            },
            {
                "title": "Fish Fountain",
                "guid": "b0912bc0b68049e4892b08e03897c002.16",
                "latlng": "47.486199,-122.173564"
            },
            {
                "title": "Vietnamese National Feature Columbarium",
                "guid": "2a1330a3d29e4e3798fa836432471f0e.16",
                "latlng": "47.485744,-122.174095"
            },
            {
                "title": "Forever Together Memorial",
                "guid": "a3f3ef644cc241a590824bfb904c3f77.16",
                "latlng": "47.486846,-122.172553"
            },
            {
                "title": "Dragon Fountain",
                "guid": "3057b4738a3443b49d115229ef90d1cf.16",
                "latlng": "47.485676,-122.173525"
            },
            {
                "title": "Memorial Fountain",
                "guid": "4a2ffcfa3af142bdaac3e50036ebd740.16",
                "latlng": "47.486942,-122.171348"
            },
            {
                "title": "Gazebo Memorial",
                "guid": "39b6e55744c84b7cad9cb1e920532400.16",
                "latlng": "47.487901,-122.173749"
            },
            {
                "title": "Neoclassic Pillar",
                "guid": "be836c86ca2c4031949afc21c62bd153.16",
                "latlng": "47.488107,-122.172259"
            },
            {
                "title": "Yui-Mien Community of Washington",
                "guid": "52db81fef66a4775a98665aa234fb3f2.16",
                "latlng": "47.487657,-122.172384"
            },
            {
                "title": "South Lawn Memorial",
                "guid": "44223eeb69b74293aad74abd2a6086c4.16",
                "latlng": "47.485165,-122.172433"
            },
            {
                "title": "Prisoner of War Memorial",
                "guid": "1ef0630e7f3644989e0a2bd6027b840f.16",
                "latlng": "47.486325,-122.172827"
            },
            {
                "title": "Cedar View Memorial",
                "guid": "cd2f34d0a9d14319a4009265c0270b6e.16",
                "latlng": "47.488451,-122.169666"
            }
            */
            ];
        
//p1 https://intel.ingress.com/intel?ll=47.486764,-122.171799&z=17&pll=47.48793,-122.173166
//p2 https://intel.ingress.com/intel?ll=47.486764,-122.171799&z=17&pll=47.488078,-122.169664
//p3 https://intel.ingress.com/intel?ll=47.486764,-122.171799&z=17&pll=47.486942,-122.171348
//p4 https://intel.ingress.com/intel?ll=47.486764,-122.171799&z=17&pll=47.485165,-122.172433
//p5 https://intel.ingress.com/intel?ll=47.486764,-122.171799&z=17&pll=47.486514,-122.173947
        
        let results = "\tArea\tMU\n";
        
        let portalCount = portals.length;
        for (let i=0; i<portalCount; i++) {
            let latlngArray = portals[i].latlng.split(',');
            let lat = parseFloat(latlngArray[0]);
            let lng = parseFloat(latlngArray[1]);
            portals[i].googleLatLng = new google.maps.LatLng(lat, lng);
        }
        for (let i=0; i<portalCount - 2; i++) {
            for (let j=i+1; j<portalCount -1 ; j++) {
                for (let k=j+1; k<portalCount; k++) {

                    let triangle = [
                        portals[i].googleLatLng,
                        portals[j].googleLatLng,
                        portals[k].googleLatLng
                    ];
                    results += portals[i].title + " - "  + portals[j].title + " - " + portals[k].title + "\t";
                    results += google.maps.geometry.spherical.computeArea(triangle) + "\t\n";
                }
            }
        }
        console.log(results);
        
        //let triangle = [new google.maps.LatLng(47.48793,-122.173166),
        //                new google.maps.LatLng(47.488078,-122.169664),
        //                new google.maps.LatLng(47.486514,-122.173947)];
        //let area = google.maps.geometry.spherical.computeArea(triangle);
        //console.log(area);
        
        $("#slider").slider({min:9, max:18, slide: function(event, ui) {
            refreshS2Grid(ui.value);
        }});
        $("#s2cellLevel").val($("#slider").slider("value"));
        
        
        new google.maps.Polygon({
            path: [{"lat":47.994058,"lng":-122.242468},{"lat":47.430873,"lng":-123.977276},{"lat":46.457519,"lng":-122.693956},{"lat":46.984342,"lng":-120.994610}],
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWeight: 1,
            fillOpacity: 0,
            map: map
        });
        

        $.getJSON('portals.json', function (data) {
            for (let i=0; i<data.portals.length; i++) {
                let latlngArray = data.portals[i].latlng.split(',');
                let lat = parseFloat(latlngArray[0]);
                let lng = parseFloat(latlngArray[1]);
                
                data.portals[i].lat = lat;
                data.portals[i].lng = lng;
                let name = data.portals[i].title + " " + data.portals[i].latlng;
                
                let marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat, lng),
                    map: map,
                    icon: {url: './images/hum_reso_08.png', scaledSize: new google.maps.Size(20, 20), anchor: new google.maps.Point(10,10)},
                    title: name
                });
            }
        });

        /*
        let fieldNames = [
            "East Memorial Wall - Memorial Fountain - South Lawn Memorial",
            "All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial",
            "Metamorphosis - East Memorial Wall - South Lawn Memorial",
            "Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Love Forever Headstone",
            "Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial",
            "All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Cedar View Memorial",
            "Love Forever Headstone - Fish Fountain - Prisoner of War Memorial",
            "Yeah Yeah Thanks Puddin - Remembered Forever - Fountain of Youth",
            "Metamorphosis - Jimi Hendrix Memorial - South Lawn Memorial",
            "Garden of Harmony - Love Forever Headstone - Fish Fountain",
            "Garden of Harmony - Remembered Forever - Fountain of Youth",
            "Iu-Mienh Community Memorial  - Fish Fountain - Prisoner of War Memorial",
            "Metamorphosis - Memorial Fountain - South Lawn Memorial",
            "Garden of Harmony - Iu-Mienh Community Memorial  - Fountain of Youth",
            "Iu-Mienh Community Memorial  - South Lawn Memorial - Prisoner of War Memorial",
            "Garden of Harmony - Love Forever Headstone - Remembered Forever",
            "Lullabyland Memorial - South Lawn Memorial - Prisoner of War Memorial",
            "Lullabyland Memorial - Love Forever Headstone - Prisoner of War Memorial",
            "Lullabyland Memorial - Sun Dial - South Lawn Memorial",
            "Garden of Harmony - Iu-Mienh Community Memorial  - Fish Fountain"
        ];
        */
        /*
        let bothCells = [
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.487022,lng:-122.170667}),
                    new google.maps.LatLng({lat:47.487227,lng:-122.170926}),
                    new google.maps.LatLng({lat:47.486942,lng:-122.171348}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.487022,lng:-122.170667})
                ],
                intersect549067df:[
                    new google.maps.LatLng({lat:47.488078,lng:-122.169664}),
                    new google.maps.LatLng({lat:47.487227,lng:-122.170926}),
                    new google.maps.LatLng({lat:47.487022,lng:-122.170667}),
                    new google.maps.LatLng({lat:47.488078,lng:-122.169664})
                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486724,lng:-122.170291}),
                    new google.maps.LatLng({lat:47.487732,lng:-122.171563}),
                    new google.maps.LatLng({lat:47.486194,lng:-122.171397}),
                    new google.maps.LatLng({lat:47.486724,lng:-122.170291})
                ],
                intersect549067df:[
                    new google.maps.LatLng({lat:47.486764,lng:-122.170208}),
                    new google.maps.LatLng({lat:47.488222,lng:-122.171616}),
                    new google.maps.LatLng({lat:47.487732,lng:-122.171563}),
                    new google.maps.LatLng({lat:47.486724,lng:-122.170291}),
                    new google.maps.LatLng({lat:47.486764,lng:-122.170208})
                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.487022,lng:-122.170667}),
                    new google.maps.LatLng({lat:47.487984,lng:-122.171882}),
                    new google.maps.LatLng({lat:47.487930,lng:-122.173166}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433})
                ],
                intersect549067df:[
                    new google.maps.LatLng({lat:47.487984,lng:-122.171882}),
                    new google.maps.LatLng({lat:47.487022,lng:-122.170667}),
                    new google.maps.LatLng({lat:47.488078,lng:-122.169664}),
                    new google.maps.LatLng({lat:47.487984,lng:-122.171882})
                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124}),
                    new google.maps.LatLng({lat:47.487851,lng:-122.171714}),
                    new google.maps.LatLng({lat:47.488039,lng:-122.171951}),
                    new google.maps.LatLng({lat:47.487520,lng:-122.172903}),
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124})
                ],
                intersect549067df:[
                    new google.maps.LatLng({lat:47.488039,lng:-122.171951}),
                    new google.maps.LatLng({lat:47.487851,lng:-122.171714}),
                    new google.maps.LatLng({lat:47.488222,lng:-122.171616}),
                    new google.maps.LatLng({lat:47.488039,lng:-122.171951})
                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486194,lng:-122.171397}),
                    new google.maps.LatLng({lat:47.487732,lng:-122.171563}),
                    new google.maps.LatLng({lat:47.487851,lng:-122.171714}),
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124}),
                    new google.maps.LatLng({lat:47.486194,lng:-122.171397})
                ],
                intersect549067df:[
                    new google.maps.LatLng({lat:47.487851,lng:-122.171714}),
                    new google.maps.LatLng({lat:47.487732,lng:-122.171563}),
                    new google.maps.LatLng({lat:47.488222,lng:-122.171616}),
                    new google.maps.LatLng({lat:47.487851,lng:-122.171714})
                ]
            },
            {
                intersect549067e1:[

                ],
                intersect549067df:[
                    new google.maps.LatLng({lat:47.488451,lng:-122.169666}),
                    new google.maps.LatLng({lat:47.488222,lng:-122.171616}),
                    new google.maps.LatLng({lat:47.486764,lng:-122.170208}),
                    new google.maps.LatLng({lat:47.488451,lng:-122.169666})
                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.487520,lng:-122.172903}),
                    new google.maps.LatLng({lat:47.486199,lng:-122.173564}),
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827}),
                    new google.maps.LatLng({lat:47.487520,lng:-122.172903})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486378,lng:-122.174457}),
                    new google.maps.LatLng({lat:47.487686,lng:-122.173709}),
                    new google.maps.LatLng({lat:47.488086,lng:-122.174574}),
                    new google.maps.LatLng({lat:47.486378,lng:-122.174457})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.487930,lng:-122.173166}),
                    new google.maps.LatLng({lat:47.486514,lng:-122.173947}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.487930,lng:-122.173166})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486199,lng:-122.173564}),
                    new google.maps.LatLng({lat:47.487520,lng:-122.172903}),
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687}),
                    new google.maps.LatLng({lat:47.486199,lng:-122.173564})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687}),
                    new google.maps.LatLng({lat:47.487686,lng:-122.173709}),
                    new google.maps.LatLng({lat:47.486378,lng:-122.174457}),
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827}),
                    new google.maps.LatLng({lat:47.486199,lng:-122.173564}),
                    new google.maps.LatLng({lat:47.485350,lng:-122.174513}),
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.486942,lng:-122.171348}),
                    new google.maps.LatLng({lat:47.487930,lng:-122.173166}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486378,lng:-122.174457}),
                    new google.maps.LatLng({lat:47.485350,lng:-122.174513}),
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687}),
                    new google.maps.LatLng({lat:47.486378,lng:-122.174457})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.485350,lng:-122.174513}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827}),
                    new google.maps.LatLng({lat:47.485350,lng:-122.174513})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687}),
                    new google.maps.LatLng({lat:47.487520,lng:-122.172903}),
                    new google.maps.LatLng({lat:47.487686,lng:-122.173709}),
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124}),
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124}),
                    new google.maps.LatLng({lat:47.487520,lng:-122.172903}),
                    new google.maps.LatLng({lat:47.486325,lng:-122.172827}),
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433}),
                    new google.maps.LatLng({lat:47.486194,lng:-122.171397}),
                    new google.maps.LatLng({lat:47.486297,lng:-122.172124}),
                    new google.maps.LatLng({lat:47.485165,lng:-122.172433})
                ],
                intersect549067df:[

                ]
            },
            {
                intersect549067e1:[
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687}),
                    new google.maps.LatLng({lat:47.485350,lng:-122.174513}),
                    new google.maps.LatLng({lat:47.486199,lng:-122.173564}),
                    new google.maps.LatLng({lat:47.486712,lng:-122.173687})
                ],
                intersect549067df:[

                ]
            }          
        ];

        let result="";
        for (let b=0; b < bothCells.length; b++) {
            // Metamorphosis - East Memorial Wall - Memorial Fountain
            // Intersection with 549067e1 in the south west:
            //let polygon = [
            //    new google.maps.LatLng({lat:47.486942,lng:-122.171348}),
            //    new google.maps.LatLng({"lat":47.487227,"lng":-122.170926}),
            //    new google.maps.LatLng({"lat":47.487984,"lng":-122.171882}),
            //    new google.maps.LatLng({"lat":47.487930,"lng":-122.173166}),
            //    new google.maps.LatLng({"lat":47.486942,"lng":-122.171348})
            //];
            let polygon = bothCells[b].intersect549067e1;
            console.log("Area of " + fieldNames[b] + " intersected with 549067e1");
            console.log(google.maps.geometry.spherical.computeArea(polygon) + "\n");
            result += google.maps.geometry.spherical.computeArea(polygon) + "\t";

            // Intersection with 549067df in the north east:
            //polygon = [
            //    new google.maps.LatLng({"lat":47.487984,"lng":-122.171882}),
            //    new google.maps.LatLng({"lat":47.487227,"lng":-122.170926}),
            //    new google.maps.LatLng({"lat":47.488078,"lng":-122.169664}),
            //    new google.maps.LatLng({"lat":47.487984,"lng":-122.171882})
            //];
            polygon = bothCells[b].intersect549067df;
            console.log("Area of " + fieldNames[b] + " intersected 549067df");
            console.log(google.maps.geometry.spherical.computeArea(polygon) + "\n");
            result += google.maps.geometry.spherical.computeArea(polygon) + "\n";
        }
        console.log("Paste into Excel:");
        console.log(result);
        /*
/*
        $.ajax({
    // cells cellID_cellID_... 
    // fields lat,lng_lat,lng_lat,lng-lat,lng_lat,lng_lat,lng-...            
            url:"http://localhost:5000/intersect?cells=549067e1_549067df&fields=" + 
                // East Memorial Wall - Memorial Fountain - South Lawn Memorial
                "47.488078,-122.169664_47.486942,-122.171348_47.485165,-122.172433+" +
                //All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial
                "47.486764,-122.170208_47.488222,-122.171616_47.486194,-122.171397+" +
                //Metamorphosis - East Memorial Wall - South Lawn Memorial
                "47.48793,-122.173166_47.488078,-122.169664_47.485165,-122.172433+" +
                //Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Love Forever Headstone
                "47.486297,-122.172124_47.488222,-122.171616_47.48752,-122.172903+" +
                //Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial
                "47.486297,-122.172124_47.488222,-122.171616_47.486194,-122.171397+" +
                //All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Cedar View Memorial
                "47.486764,-122.170208_47.488222,-122.171616_47.488451,-122.169666+" +
                //Love Forever Headstone - Fish Fountain - Prisoner of War Memorial
                "47.48752,-122.172903_47.486199,-122.173564_47.486325,-122.172827+" +
                //Yeah Yeah Thanks Puddin - Remembered Forever - Fountain of Youth
                "47.488086,-122.174574_47.487686,-122.173709_47.486378,-122.174457+" +
                //Metamorphosis - Jimi Hendrix Memorial - South Lawn Memorial
                "47.48793,-122.173166_47.486514,-122.173947_47.485165,-122.172433+" +
                //Garden of Harmony - Love Forever Headstone - Fish Fountain
                "47.486712,-122.173687_47.48752,-122.172903_47.486199,-122.173564+" +
                //Garden of Harmony - Remembered Forever - Fountain of Youth
                "47.486712,-122.173687_47.487686,-122.173709_47.486378,-122.174457+" +
                //Iu-Mienh Community Memorial  - Fish Fountain - Prisoner of War Memorial
                "47.48535,-122.174513_47.486199,-122.173564_47.486325,-122.172827+" +
                //Metamorphosis - Memorial Fountain - South Lawn Memorial
                "47.48793,-122.173166_47.486942,-122.171348_47.485165,-122.172433+" +
                //Garden of Harmony - Iu-Mienh Community Memorial  - Fountain of Youth
                "47.486712,-122.173687_47.48535,-122.174513_47.486378,-122.174457+" +
                //Iu-Mienh Community Memorial  - South Lawn Memorial - Prisoner of War Memorial
                "47.48535,-122.174513_47.485165,-122.172433_47.486325,-122.172827+" +
                //Garden of Harmony - Love Forever Headstone - Remembered Forever
                "47.486712,-122.173687_47.48752,-122.172903_47.487686,-122.173709+" +
                //Lullabyland Memorial - South Lawn Memorial - Prisoner of War Memorial
                "47.486297,-122.172124_47.485165,-122.172433_47.486325,-122.172827+" +
                //Lullabyland Memorial - Love Forever Headstone - Prisoner of War Memorial
                "47.486297,-122.172124_47.48752,-122.172903_47.486325,-122.172827+" +
                //Lullabyland Memorial - Sun Dial - South Lawn Memorial
                "47.486297,-122.172124_47.486194,-122.171397_47.485165,-122.172433+" +
                //Garden of Harmony - Iu-Mienh Community Memorial  - Fish Fountain
                "47.486712,-122.173687_47.48535,-122.174513_47.486199,-122.173564"
            ,
            success:function(data){
                //console.log(data); // need to format for Excel
                let intersections = JSON.parse(data);
                let result="";
                for (let b=0; b < fieldNames.length; b++) {
                    // Metamorphosis - East Memorial Wall - Memorial Fountain
                    // Intersection with 549067e1 in the south west:
                    //let polygon = [
                    //    new google.maps.LatLng({lat:47.486942,lng:-122.171348}),
                    //    new google.maps.LatLng({"lat":47.487227,"lng":-122.170926}),
                    //    new google.maps.LatLng({"lat":47.487984,"lng":-122.171882}),
                    //    new google.maps.LatLng({"lat":47.487930,"lng":-122.173166}),
                    //    new google.maps.LatLng({"lat":47.486942,"lng":-122.171348})
                    //];
                    let polygon = intersections["549067e1"][b].map(x => new google.maps.LatLng(x));
                    console.log(polygon);                    
                    console.log("Area of " + fieldNames[b] + " intersected with 549067e1");
                    console.log(google.maps.geometry.spherical.computeArea(polygon) + "\n");
                    result += google.maps.geometry.spherical.computeArea(polygon) + "\t";

                    // Intersection with 549067df in the north east:
                    //polygon = [
                    //    new google.maps.LatLng({"lat":47.487984,"lng":-122.171882}),
                    //    new google.maps.LatLng({"lat":47.487227,"lng":-122.170926}),
                    //    new google.maps.LatLng({"lat":47.488078,"lng":-122.169664}),
                    //    new google.maps.LatLng({"lat":47.487984,"lng":-122.171882})
                    //];
                    polygon = intersections["549067df"][b].map(x => new google.maps.LatLng(x));
                    console.log("Area of " + fieldNames[b] + " intersected 549067df");
                    console.log(google.maps.geometry.spherical.computeArea(polygon) + "\n");
                    result += google.maps.geometry.spherical.computeArea(polygon) + "\n";
                }
                console.log("Paste into Excel:");
                console.log(result);
            },
            error:function(jqXHR, textStatus, errorThrown) {
                console.log('getJSON request failed! ' + textStatus);
                console.log("incoming Text " + jqXHR.responseText);
            }      
        });                         
*/
let fields = [
    {name:"St. Matthew's Lutheran Church - Gymnasium At Highlands Church - Bethlehem Lutheran Church",                       mu: 206},
    {name:"St. Matthew's Lutheran Church - Bethlehem Lutheran Church - First Ukrainian Pentecostal Church",                  mu: 639},
    {name:"Gymnasium At Highlands Church - Bethlehem Lutheran Church - Powerline Playground",                                mu: 229},
    {name:"Martin Luther King Jr Memorial Baptist Church - Powerline Playground - First Ukrainian Pentecostal Church",       mu: 854},
    {name:"Bethlehem Lutheran Church - Powerline Playground - First Ukrainian Pentecostal Church",                           mu: 646},
    {name:"Horse Sculpture - St. Matthew's Lutheran Church - Gymnasium At Highlands Church",                                 mu: 256},
    {name:"Horse Sculpture - Gymnasium At Highlands Church - Powerline Playground",                                          mu: 8},
    {name:"St. Matthew's Lutheran Church - Colleen's Little Free Library - Bethlehem Lutheran Church",                       mu: 722},
    {name:"Colleen's Little Free Library - Bethlehem Lutheran Church - Powerline Playground",                                mu: 841},
    {name:"Moonlit Swan Mural - Meadow Crest Playground - Caterpillar Land Structure",                                       mu: 5},
    {name:"Sunset Community Garden - Buddhist Foundation - Calvary Baptist Church",                                          mu: 7},
    {name:"Church of Nazarene - Martin Luther King Jr Memorial Baptist Church - Renton Bible Church",                        mu: 67},
    {name:"Colleen's Little Free Library - Kingdom Hall Of Jehovah's Witnesses - Hazen Water Tower",                         mu: 112},
    {name:"Colleen's Little Free Library - Kingdom Hall Of Jehovah's Witnesses - Pickled Onion British Pub",                 mu: 136},
    {name:"Colleen's Little Free Library - First Ukrainian Pentecostal Church - Pickled Onion British Pub",                  mu: 98},
    {name:"Martin Luther King Jr Memorial Baptist Church - Renton Bible Church - Pickled Onion British Pub",                 mu: 194},
    {name:"Martin Luther King Jr Memorial Baptist Church - Kingdom Hall Of Jehovah's Witnesses - Hazen Water Tower",         mu: 59},
    {name:"Martin Luther King Jr Memorial Baptist Church - Kingdom Hall Of Jehovah's Witnesses - Pickled Onion British Pub", mu: 163},    
    {name:"Caterpillar Land Structure - Saint Andrew Presbyterian Church - Pickled Onion British Pub",                       mu: 370},
    {name:"Martin Luther King Jr Memorial Baptist Church - Renton Bible Church - Powerline Playground",                      mu: 248},
    {name:"Martin Luther King Jr Memorial Baptist Church - Powerline Playground - LDS Church",                               mu: 400},
    {name:"Martin Luther King Jr Memorial Baptist Church - LDS Church - Hazen Water Tower",                                  mu: 230},
    {name:"St. Matthew's Lutheran Church - Meadow Crest Playground - Bethlehem Lutheran Church",                             mu: 185},
    {name:"Union Plaque at Renton Technical College - Gymnasium At Highlands Church - Renton Community of Christ",           mu: 37},
    {name:"Gymnasium At Highlands Church - Bethlehem Lutheran Church - Renton Community of Christ",                          mu: 76},
    {name:"Kiwanis Park Ball Field - Bethlehem Lutheran Church - Saint Andrew Presbyterian Church",                          mu: 87},
    {name:"Church of Nazarene - Martin Luther King Jr Memorial Baptist Church - Kingdom Hall Of Jehovah's Witnesses",        mu: 91},
    {name:"St. Matthew's Lutheran Church - Bear Sculpture - Caterpillar Land Structure",                                     mu: 6},
    {name:"St. Matthew's Lutheran Church - Meadow Crest Playground - Caterpillar Land Structure",                            mu: 6},
    {name:"Kiwanis Park Ball Field - Bethlehem Lutheran Church - Powerline Playground",                                     mu:	217},
    {name:"Bethlehem Lutheran Church - Powerline Playground - Renton Community of Christ",                                  mu:	212},
    {name:"Hilltop Neighborhood Playground - Powerline Playground - Renton Community of Christ",	mu:	105},
    {name:"Kiwanis Park Hoops - Kiwanis Park Ball Field - Powerline Playground",	mu:	8},
    {name:"Kiwanis Park Hoops - Powerline Playground - Renton Community of Christ",	mu:	246},
    {name:"Kiwanis Park Ball Field - Powerline Playground - Kiwanis Park Community Center",	mu:	26},
    {name:"Kiwanis Park - Powerline Playground - Kiwanis Park Tennis Courts",	mu:	12},
    {name:"Powerline Playground - Kiwanis Park Community Center - Kiwanis Park Playground",	mu:	10},
    {name:"Powerline Playground - Kiwanis Park Playground - Kiwanis Park Tennis Courts",	mu:	2},
    {name:"Metamorphosis - East Memorial Wall - Memorial Fountain", mu: 17},
    {name:"East Memorial Wall - Memorial Fountain - South Lawn Memorial",	mu:8},
    {name:"All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial",	mu:11},
    {name:"Metamorphosis - East Memorial Wall - South Lawn Memorial",	mu:42},
    {name:"Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Love Forever Headstone",	mu:9},
    {name:"Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial",	mu:6},
    {name:"All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Cedar View Memorial",	mu:17},
    {name:"Love Forever Headstone - Fish Fountain - Prisoner of War Memorial",	mu:4},
    {name:"Yeah Yeah Thanks Puddin - Remembered Forever - Fountain of Youth",	mu:6},
    {name:"Metamorphosis - Jimi Hendrix Memorial - South Lawn Memorial",	mu:13},
    {name:"Garden of Harmony - Love Forever Headstone - Fish Fountain",	mu:2},
    {name:"Garden of Harmony - Remembered Forever - Fountain of Youth",	mu:3},
    {name:"Iu-Mienh Community Memorial  - Fish Fountain - Prisoner of War Memorial",	mu:2},
    {name:"Metamorphosis - Memorial Fountain - South Lawn Memorial",	mu:17},
    {name:"Garden of Harmony - Iu-Mienh Community Memorial  - Fountain of Youth",	mu:3},
    {name:"Iu-Mienh Community Memorial  - South Lawn Memorial - Prisoner of War Memorial",	mu:9},
    {name:"Garden of Harmony - Love Forever Headstone - Remembered Forever",	mu:3},
    {name:"Lullabyland Memorial - South Lawn Memorial - Prisoner of War Memorial",	mu:3},
    {name:"Lullabyland Memorial - Love Forever Headstone - Prisoner of War Memorial",	mu:3},
    {name:"Lullabyland Memorial - Sun Dial - South Lawn Memorial",	mu:3},
    {name:"Garden of Harmony - Iu-Mienh Community Memorial  - Fish Fountain", mu:2},
    {name:"Renton Aerie No 1722 F.O.E. - Greenwood Memorial Geometrical Fountain - Powerline Playground", mu:	31},
    {name:"Sempre nel nostro cuore..Con amure bench - Garden of Friends Bench - Powerline Playground", mu:	3},
    {name:"Sempre nel nostro cuore..Con amure bench - Greenwood Memorial Geometrical Fountain - Powerline Playground", mu:	8},
    {name:"Garden of Friends Bench - Powerline Playground - East Memorial Wall", mu:	5},
    {name:"Metamorphosis - Gazebo Memorial - Powerline Playground", mu:	11},
    {name:"Bear Sculpture - Caterpillar Land Structure - First Ukrainian Pentecostal Church", mu:	13},
    {name:"Meadow Crest Playground - Caterpillar Land Structure - First Ukrainian Pentecostal Church", mu:	14},
    {name:"Meadow Crest Playground - Playground At Saint Andrew's Church - First Ukrainian Pentecostal Church", mu:	437},
    {name:"Meadow Crest Playground - Saint Andrew Presbyterian Church - First Ukrainian Pentecostal Church", mu:	462},
    {name:"Sierra Heights Park - Glencoe Park, Renton, WA - First Ukrainian Pentecostal Church", mu:	108},
    {name:"Sierra Heights Park - First Ukrainian Pentecostal Church - Welcome To Sunset Neighborhood Park", mu:	322},
    {name:"Colleen's Little Free Library - Glencoe Park, Renton, WA - First Ukrainian Pentecostal Church", mu:	82},
    {name:"Colleen's Little Free Library - Glencoe Park, Renton, WA - Shannon's Village Clocktower", mu:	81},
    {name:"Colleen's Little Free Library - First Ukrainian Pentecostal Church - Welcome To Sunset Neighborhood Park", mu:	282},
    {name:"Colleen's Little Free Library - Welcome To Sunset Neighborhood Park - Shannon's Village Clocktower", mu:	378},
    {name:"Metamorphosis - Gazebo Memorial - Shannon's Village Clocktower", mu:		58},
    {name:"Powerline Playground - East Memorial Wall - Shannon's Village Clocktower", mu:		150},
    {name:"Horse Sculpture - St. Matthew's Lutheran Church - KCLS: Renton Highlands Branch", mu:	108},
    {name:"Horse Sculpture - Sunset Community Garden - KCLS: Renton Highlands Branch", mu:	204},
    {name:"St. Matthew's Lutheran Church - First Ukrainian Pentecostal Church - KCLS: Renton Highlands Branch", mu:	314},
    //{name:"Sunset Community Garden - Calvary Baptist Church - Sunset Court Park", mu:	12},
    {name:"Sunset Community Garden - Sunset Court Park - KCLS: Renton Highlands Branch", mu:	29},
    //{name:"Calvary Baptist Church - Sunset Court Park - Welcome To Sunset Neighborhood Park", mu:	192},
    {name:"Calvary Baptist Church - Kingdom Hall Of Jehovah's Witnesses - Little Free Library At Sunset Neighborhood Park", mu:	19},
    {name:"Calvary Baptist Church - Kingdom Hall Of Jehovah's Witnesses - Welcome To Sunset Neighborhood Park", mu:	26},
    //{name:"Sunset Court Park - Kingdom Hall Of Jehovah's Witnesses - KCLS: Renton Highlands Branch", mu:	164},
    {name:"Sunset Court Park - Kingdom Hall Of Jehovah's Witnesses - Welcome To Sunset Neighborhood Park", mu:	153},
    {name:"Kingdom Hall Of Jehovah's Witnesses - First Ukrainian Pentecostal Church - KCLS: Renton Highlands Branch", mu:	666}
];
let fieldList = "47.506376,-122.185405_47.498003,-122.178323_47.500174,-122.174971+47.506376,-122.185405_47.500174,-122.174971_47.510143,-122.167571+47.498003,-122.178323_47.500174,-122.174971_47.492046,-122.168065+47.499248,-122.158894_47.492046,-122.168065_47.510143,-122.167571+47.500174,-122.174971_47.492046,-122.168065_47.510143,-122.167571+" +
                "47.505053,-122.190736_47.506376,-122.185405_47.498003,-122.178323+47.505053,-122.190736_47.498003,-122.178323_47.492046,-122.168065+47.506376,-122.185405_47.50898,-122.16181_47.500174,-122.174971+47.50898,-122.16181_47.500174,-122.174971_47.492046,-122.168065+" +
                "47.506584,-122.184391_47.507129,-122.180379_47.507376,-122.180548+47.50004,-122.186714_47.501111,-122.185214_47.500027,-122.185346+47.497344,-122.164351_47.499248,-122.158894_47.499119,-122.164861+" +
                "47.50898,-122.16181_47.502637,-122.156826_47.503198,-122.153707+47.50898,-122.16181_47.502637,-122.156826_47.504539,-122.163725+47.50898,-122.16181_47.510143,-122.167571_47.504539,-122.163725+47.499248,-122.158894_47.499119,-122.164861_47.504539,-122.163725+47.499248,-122.158894_47.502637,-122.156826_47.503198,-122.153707+47.499248,-122.158894_47.502637,-122.156826_47.504539,-122.163725+" +
                "47.507376,-122.180548_47.500188,-122.17064_47.504539,-122.163725+47.499248,-122.158894_47.499119,-122.164861_47.492046,-122.168065+47.499248,-122.158894_47.492046,-122.168065_47.496204,-122.153594+47.499248,-122.158894_47.496204,-122.153594_47.503198,-122.153707+" +
                "47.506376,-122.185405_47.507129,-122.180379_47.500174,-122.174971+47.49368,-122.176582_47.498003,-122.178323_47.495442,-122.175727+47.498003,-122.178323_47.500174,-122.174971_47.495442,-122.175727+47.496466,-122.166939_47.500174,-122.174971_47.500188,-122.17064+47.497344,-122.164351_47.499248,-122.158894_47.502637,-122.156826+" +
                "47.506376,-122.185405_47.507695,-122.180226_47.507376,-122.180548+47.506376,-122.185405_47.507129,-122.180379_47.507376,-122.180548+" +
                "47.496466,-122.166939_47.500174,-122.174971_47.492046,-122.168065+47.500174,-122.174971_47.492046,-122.168065_47.495442,-122.175727+" +
                "47.491105,-122.171558_47.492046,-122.168065_47.495442,-122.175727+47.49743,-122.167013_47.496466,-122.166939_47.492046,-122.168065+47.49743,-122.167013_47.492046,-122.168065_47.495442,-122.175727+47.496466,-122.166939_47.492046,-122.168065_47.497176,-122.165689+47.496787,-122.164995_47.492046,-122.168065_47.497165,-122.165215+47.492046,-122.168065_47.497176,-122.165689_47.496784,-122.165511+47.492046,-122.168065_47.496784,-122.165511_47.497165,-122.165215+" +

                // need Metamorphosis - East Memorial Wall - Memorial Fountain
                "47.48793,-122.173166_47.488078,-122.169664_47.486942,-122.171348+" +
                // East Memorial Wall - Memorial Fountain - South Lawn Memorial
                "47.488078,-122.169664_47.486942,-122.171348_47.485165,-122.172433+" +
                //All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial
                "47.486764,-122.170208_47.488222,-122.171616_47.486194,-122.171397+" +
                //Metamorphosis - East Memorial Wall - South Lawn Memorial
                "47.48793,-122.173166_47.488078,-122.169664_47.485165,-122.172433+" +
                //Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Love Forever Headstone
                "47.486297,-122.172124_47.488222,-122.171616_47.48752,-122.172903+" +
                //Lullabyland Memorial - Renton Aerie No 1722 F.O.E. - Sun Dial
                "47.486297,-122.172124_47.488222,-122.171616_47.486194,-122.171397+" +
                //All to Myself I Think of You Memorial - Renton Aerie No 1722 F.O.E. - Cedar View Memorial
                "47.486764,-122.170208_47.488222,-122.171616_47.488451,-122.169666+" +
                //Love Forever Headstone - Fish Fountain - Prisoner of War Memorial
                "47.48752,-122.172903_47.486199,-122.173564_47.486325,-122.172827+" +
                //Yeah Yeah Thanks Puddin - Remembered Forever - Fountain of Youth
                "47.488086,-122.174574_47.487686,-122.173709_47.486378,-122.174457+" +
                //Metamorphosis - Jimi Hendrix Memorial - South Lawn Memorial
                "47.48793,-122.173166_47.486514,-122.173947_47.485165,-122.172433+" +
                //Garden of Harmony - Love Forever Headstone - Fish Fountain
                "47.486712,-122.173687_47.48752,-122.172903_47.486199,-122.173564+" +
                //Garden of Harmony - Remembered Forever - Fountain of Youth
                "47.486712,-122.173687_47.487686,-122.173709_47.486378,-122.174457+" +
                //Iu-Mienh Community Memorial  - Fish Fountain - Prisoner of War Memorial
                "47.48535,-122.174513_47.486199,-122.173564_47.486325,-122.172827+" +
                //Metamorphosis - Memorial Fountain - South Lawn Memorial
                "47.48793,-122.173166_47.486942,-122.171348_47.485165,-122.172433+" +
                //Garden of Harmony - Iu-Mienh Community Memorial  - Fountain of Youth
                "47.486712,-122.173687_47.48535,-122.174513_47.486378,-122.174457+" +
                //Iu-Mienh Community Memorial  - South Lawn Memorial - Prisoner of War Memorial
                "47.48535,-122.174513_47.485165,-122.172433_47.486325,-122.172827+" +
                //Garden of Harmony - Love Forever Headstone - Remembered Forever
                "47.486712,-122.173687_47.48752,-122.172903_47.487686,-122.173709+" +
                //Lullabyland Memorial - South Lawn Memorial - Prisoner of War Memorial
                "47.486297,-122.172124_47.485165,-122.172433_47.486325,-122.172827+" +
                //Lullabyland Memorial - Love Forever Headstone - Prisoner of War Memorial
                "47.486297,-122.172124_47.48752,-122.172903_47.486325,-122.172827+" +
                //Lullabyland Memorial - Sun Dial - South Lawn Memorial
                "47.486297,-122.172124_47.486194,-122.171397_47.485165,-122.172433+" +
                //Garden of Harmony - Iu-Mienh Community Memorial  - Fish Fountain
                "47.486712,-122.173687_47.48535,-122.174513_47.486199,-122.173564+" +

                "47.488222,-122.171616_47.487722,-122.170559_47.492046,-122.168065+47.487944,-122.170096_47.488083,-122.169903_47.492046,-122.168065+47.487944,-122.170096_47.487722,-122.170559_47.492046,-122.168065+47.488083,-122.169903_47.492046,-122.168065_47.488078,-122.169664+47.48793,-122.173166_47.487901,-122.173749_47.492046,-122.168065+" +
                "47.507695,-122.180226_47.507376,-122.180548_47.510143,-122.167571+47.507129,-122.180379_47.507376,-122.180548_47.510143,-122.167571+47.507129,-122.180379_47.500608,-122.170687_47.510143,-122.167571+47.507129,-122.180379_47.500188,-122.17064_47.510143,-122.167571+" +
                "47.5137,-122.170932_47.513129,-122.159758_47.510143,-122.167571+47.5137,-122.170932_47.510143,-122.167571_47.500431,-122.18301+47.50898,-122.16181_47.513129,-122.159758_47.510143,-122.167571+47.50898,-122.16181_47.513129,-122.159758_47.506698,-122.15555+47.50898,-122.16181_47.510143,-122.167571_47.500431,-122.18301+47.50898,-122.16181_47.500431,-122.18301_47.506698,-122.15555+"+
                "47.48793,-122.173166_47.487901,-122.173749_47.506698,-122.15555+47.492046,-122.168065_47.488078,-122.169664_47.506698,-122.15555+"+ 
                "47.505053,-122.190736_47.506376,-122.185405_47.503273,-122.180721+47.505053,-122.190736_47.50004,-122.186714_47.503273,-122.180721+47.506376,-122.185405_47.510143,-122.167571_47.503273,-122.180721+"+
                //+47.50004,-122.186714_47.500027,-122.185346_47.501791,-122.181564+
                "47.50004,-122.186714_47.501791,-122.181564_47.503273,-122.180721+" +
                //"47.500027,-122.185346_47.501791,-122.181564_47.500431,-122.18301+" +
                "47.500027,-122.185346_47.502637,-122.156826_47.500223,-122.18175+" + 
                "47.500027,-122.185346_47.502637,-122.156826_47.500431,-122.18301+" +
                //"47.501791,-122.181564_47.502637,-122.156826_47.503273,-122.180721+" +
                "47.501791,-122.181564_47.502637,-122.156826_47.500431,-122.18301+" +
                "47.502637,-122.156826_47.510143,-122.167571_47.503273,-122.180721"
                ; 
let cells = ["5490686b", "54906869", "54906867", "54906861",
             "5490686d", "5490686f", "54906865", "54906863",
             "54906873", "54906871", "5490687b", "5490687d",
             "54906875", "54906877", "54906879", "5490687f",
             "549067e1", "549067df", "5490680b"];
let cellList = cells.join("_");
$.ajax({
    url:"cover?minLevel=" 
        + 14 
        + "&maxLevel="
        + 14
        + "&fields="
        + fieldList,
    error:function(jqXHR, textStatus, errorThrown) {
        if (jqXHR.status == 403) {
            console.log("Too many fields to generate cover.");
        }
        else {
            console.log('getJSON request failed! ' + textStatus);
            console.log("incoming Text " + jqXHR.responseText);
        }
    },      
    success:function(data){
        cells = JSON.parse(data);
        cellList = cells.ids.join("_");
        let areas = [];
        $.ajax({
            // cells cellID_cellID_... 
            // fields lat,lng_lat,lng_lat,lng-lat,lng_lat,lng_lat,lng-...  
            // level 12 and 13 didn't work, try 14
            // cells:  5490686b 54906869 54906867 54906861
            //         5490686d 5490686f 54906865 54906863
            //         54906873 54906871 5490687b 5490687d
            //         54906875 54906877 54906879 5490687f         
                    url:"intersect?cells=" + 
                        cellList +
                        "&fields=" + fieldList 
                    ,
                    success:function(data){
                        //console.log(data); // need to format for Excel
                        let intersections = JSON.parse(data);
                        for (let b=0; b < fields.length; b++) {
                            areas[b] = [];
                            for (let cell=0; cell < cells.ids.length; cell++) {
                                let polygon = intersections[cells.ids[cell]][b].map(x => new google.maps.LatLng(x));
                                areas[b][cell] = google.maps.geometry.spherical.computeArea(polygon);
                            }
                        }
                        FindWeights(fields, cells, areas);
                    },
                    error:function(jqXHR, textStatus, errorThrown) {
                        console.log('getJSON request failed! ' + textStatus);
                        console.log("incoming Text " + jqXHR.responseText);
                    }      
                });
            }
        });

        map.addListener('idle', function() {
            refreshS2Grid($("#slider").slider("value"));
        });        
    } // not initialized.  should do an early out.
} // initialize map

</script>
</head>

<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script>
    $.getJSON('apikey.json', function (data) {
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.src = "http://maps.googleapis.com/maps/api/js?key=" + data.key + "&libraries=geometry&callback=initializeMap";
        $("head").append(s);
    })
    .fail(function(jqXHR, textStatus, errorThrown) { 
        console.log('getJSON request failed! ' + textStatus); 
        console.log("incoming Text " + jqXHR.responseText);
    });
</script>
<div class="container">
    <div id="map_canvas"></div>
    <div id="border"></div>
    <div id="results"></div>
    <p>
        <label for = "s2cellLevel">S2 cell level:</label>
         <input type = "text" id = "s2cellLevel"
            style = "border:0; color:#b9cd6d; font-weight:bold;">
    </p>
    <div id="slider"></div>
</div>
</body>
</html>

